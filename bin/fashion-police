#!/usr/bin/env ruby

require 'rubygems'
require 'rainbow'
require 'fashion-police'

@fashion_police = FashionPolice.new
errors = []

unstaged = `git diff --name-only`.split("\n")
staged = `git diff --name-only --cached`.split("\n")

files = unstaged + staged

files.each do |filename|
  next unless filename.match(/\.js$/)
  begin
    @fashion_police.investigate(File.read(filename))
  rescue FashionPolice::BadCode
    errors << filename.background(:red)
    errors << @fashion_police.errors.collect do |element|
      element.to_s.foreground(:red)
    end
  end
end

if errors.empty?
  exit(0)
else
  puts "JavaScript style errors!".foreground(:red)
  errors.each do |error|
    puts error
  end
  exit(1)
end

